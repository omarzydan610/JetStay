@startuml backend_class_diagram

' Custom colors for packages
skinparam packageBackgroundColor<<entity>> LightBlue
skinparam packageBackgroundColor<<exception>> LightCoral
skinparam packageBackgroundColor<<mapper>> LightGreen
skinparam packageBackgroundColor<<service>> LightYellow
skinparam packageBackgroundColor<<filter>> LightSalmon
skinparam packageBackgroundColor<<strategy>> Lavender
skinparam packageBackgroundColor<<controller>> LightPink
skinparam packageBackgroundColor<<repository>> LightCyan
skinparam packageBackgroundColor<<dto>> LightGray
skinparam packageBackgroundColor<<config>> Wheat

' =================== ENTITY PACKAGE ===================
package "entity" <<entity>> {
  class User {
    Integer userID
    String firstName
    String lastName
    String email
    String password
    String phoneNumber
    UserStatus status
    UserRole role
    LocalDateTime createdAt
    +User()
    +User(Integer, String, String, String, String, String, UserStatus, UserRole, LocalDateTime)
    +onCreate(): void
  }
  class Airline {
    Integer airlineID
    String airlineName
    Float airlineRate
    String airlineNationality
    User admin
    String logoUrl
    Integer numberOfRates
    LocalDateTime createdAt
    Status status
    +Airline()
    +Airline(Integer, String, Float, String, User, String, Integer, LocalDateTime, Status)
    +onCreate(): void
  }
  class Hotel {
    Integer hotelID
    String hotelName
    Double latitude
    Double longitude
    String city
    String country
    Float hotelRate
    Integer numberOfRates
    User admin
    LocalDateTime createdAt
    String logoUrl
    Status status
    +Hotel()
    +Hotel(Integer, String, Double, Double, String, String, Float, Integer, User, LocalDateTime, String, Status)
  }
  class Flight {
    Integer flightID
    Airline airline
    Airport departureAirport
    Airport arrivalAirport
    LocalDateTime departureDate
    LocalDateTime arrivalDate
    FlightStatus status
    String description
    String planeType
    +Flight()
    +Flight(Integer, Airline, Airport, Airport, LocalDateTime, LocalDateTime, FlightStatus, String, String)
  }
  class Airport {
    Integer airportID
    String airportName
    String city
    String country
    +Airport()
    +Airport(Integer, String, String, String)
  }
  class FlightTicket {
    Integer ticketId
    Flight flight
    Airline airline
    LocalDate flightDate
    User user
    TripType tripType
    Float price
    Boolean isPaid
    +FlightTicket()
    +FlightTicket(Integer, Flight, Airline, LocalDate, User, TripType, Float, Boolean)
  }
  class TripType {
    Integer typeID
    Flight flight
    Integer quantity
    Integer price
    TripTypeName typeName
    +TripType()
    +TripType(Integer, Flight, Integer, Integer, TripTypeName)
  }
  class FlightReview {
    Integer id
    Integer userId
    Integer flightId
    Integer ticketId
    Float rating
    String comment
    LocalDateTime createdAt
    +FlightReview()
    +FlightReview(Integer, Integer, Integer, Integer, Float, String, LocalDateTime)
  }
  class UserOtp {
    Integer otpID
    User user
    String otp
    LocalDateTime createdAt
    LocalDateTime expireAt
    +UserOtp()
    +UserOtp(Integer, User, String, LocalDateTime, LocalDateTime)
    +onCreate(): void
  }
  class RoomType {
    Integer roomTypeID
    String roomTypeName
    Integer numberOfGuests
    Hotel hotel
    Integer quantity
    String description
    Float price
    +RoomType()
    +RoomType(Integer, String, Integer, Hotel, Integer, String, Float)
  }
  class HotelImage {
    Integer imageID
    Hotel hotel
    String imageUrl
    +HotelImage()
    +HotelImage(Integer, Hotel, String)
  }
  class HotelAmenity {
    Integer amenityID
    Hotel hotel
    String amenityName
    Float price
    +HotelAmenity()
    +HotelAmenity(Integer, Hotel, String, Float)
  }
  class RoomImage {
    Integer imageID
    RoomType roomType
    String imageUrl
    +RoomImage()
    +RoomImage(Integer, RoomType, String)
  }

  ' --- ENTITY RELATIONS ---
  Airline "1" -- "*" Flight : airline
  Hotel "1" -- "*" RoomType : hotel
  Hotel "1" -- "*" HotelImage : hotel
  Hotel "1" -- "*" HotelAmenity : hotel
  RoomType "1" -- "*" RoomImage : roomType
  Flight "1" -- "*" FlightTicket : flight
  Airline "1" -- "*" FlightTicket : airline
  User "1" -- "*" FlightTicket : user
  TripType "1" -- "*" FlightTicket : tripType
  Flight "1" -- "*" TripType : flight
  User "1" -- "*" UserOtp : user
  Flight "1" -- "*" FlightReview : flightId
  User "1" -- "*" FlightReview : userId
  FlightTicket "1" -- "*" FlightReview : ticketId
  Flight "*" -- "1" Airport : departureAirport
  Flight "*" -- "1" Airport : arrivalAirport
}

' =================== EXCEPTION PACKAGE ===================
package "exception" <<exception>> {
  abstract class BaseException {
    HttpStatus status
    +BaseException(HttpStatus, String)
    +BaseException(HttpStatus, String, Throwable)
  }
  class BadRequestException {
    +BadRequestException(String)
    +BadRequestException(String, Throwable)
  }
  class InternalServerErrorException {
    +InternalServerErrorException(String)
    +InternalServerErrorException(String, Throwable)
  }
  class UnauthorizedException {
    +UnauthorizedException(String)
    +UnauthorizedException(String, Throwable)
  }
  class ResourceNotFoundException {
    +ResourceNotFoundException(String)
    +ResourceNotFoundException(String, String, Object)
  }
  class GlobalExceptionHandler {
    Logger logger
    String activeProfile
    +isProduction(): boolean
    +handleBaseException(BaseException, HttpServletRequest): ResponseEntity<ErrorResponse>
    +handleValidationException(MethodArgumentNotValidException, HttpServletRequest): ResponseEntity<ErrorResponse>
    +handleIllegalArgumentException(IllegalArgumentException, HttpServletRequest): ResponseEntity<ErrorResponse>
    +handleRuntimeException(RuntimeException, HttpServletRequest): ResponseEntity<ErrorResponse>
    +handleGenericException(Exception, HttpServletRequest): ResponseEntity<ErrorResponse>
  }
  BaseException <|-- BadRequestException
  BaseException <|-- InternalServerErrorException
  BaseException <|-- UnauthorizedException
  BaseException <|-- ResourceNotFoundException
}

' =================== MAPPER PACKAGE ===================
package "mapper" <<mapper>> {
  class HotelDataMapper {
    +mapToResponse(Hotel): HotelDataResponse
  }
  class UserMapper {
    +signupToUser(UserDTO, UserRole): User
    +getUserData(User): UserDataResponse
  }
  class HotelCreatorMapper {
    +createHotel(String, Double, Double, String, String, User, String): Hotel
  }
  class AirlineDataMapper {
    +mapToResponse(Airline): AirlineDataResponse
  }
  class AirlineCreatorMapper {
    +createAirline(String, String, User, String): Airline
  }
}

' =================== SERVICE PACKAGE ===================
package "service" <<service>> {
  class GenericEmailService {
    JavaMailSender mailSender
    +sendEmail(String, String, String): void
  }
  class UserDataService {
    JwtAuthService jwtAuthService
    UserRepository userRepository
    +getData(String): UserDataResponse
  }
  class AirlineDataService {
    JwtAuthService jwtAuthService
    UserRepository userRepository
    AirlineRepository airlineRepository
    AirportRepository airportRepository
    +getData(String): AirlineDataResponse
    +updateData(String, AirlineUpdateDataRequest): void
    +getAllAirPorts(String, String): List<Airport>
    +getAllCountries(): List<CountryDtoResponse>
    +getCitiesByCountry(String): List<CityDtoResponse>
  }
  class AuthService {
    PasswordEncoder encoder
    UserRepository userRepository
    HotelRepository hotelRepository
    AirlineRepository airlineRepository
    UserMapper userMapper
    AuthenticationManager authenticationManager
    JwtAuthService jwtAuthService
    +SignUp(UserDTO): void
    +SignUp(UserDTO, UserRole): void
    +Login(LoginDTO): String
    +Googlelogin(String): String
  }
  class ForgetResetPasswordService {
    GenericEmailService emailService
    UserRepository userRepository
    UserOtpRepository userOtpRepository
    PasswordEncoder passwordEncoder
    JwtPassResetService jwtPasswordResetService
    +forgotPassword(String): void
    +getUserByEmail(String): User
    +saveOTPAndSendEmail(String, String, User, String): void
    +prepareTemplate(String, String): String
    +generateOtp(): String
    +verifyOtp(String, String): String
    +resetPassword(String, String, String): void
  }
}

' =================== FILTER PACKAGE ===================
package "filter" <<filter>> {
  class JwtAuthFilter {
    UserDetailsService userDetailsService
    JwtAuthService jwtService
    +JwtAuthFilter(UserDetailsService, JwtAuthService)
    +doFilterInternal(HttpServletRequest, HttpServletResponse, FilterChain): void
  }
}

' =================== STRATEGY PACKAGE ===================
package "strategy" <<strategy>> {
  interface StatisticsStrategy {
    +calculate(String): Double
  }
  class FlightCountStatistics {
    AirlineRepository airlineRepository
    FlightRepository flightRepository
    +FlightCountStatistics(AirlineRepository, FlightRepository)
    +calculate(String): Double
  }
  class RevenueStatistics {
    AirlineRepository airlineRepository
    FlightTicketRepository ticketRepository
    +RevenueStatistics(AirlineRepository, FlightTicketRepository)
    +calculate(String): Double
  }
  class RatingStatistics {
    AirlineRepository airlineRepository
    FlightRepository flightRepository
    FlightReviewRepository flightReviewRepository
    +RatingStatistics(AirlineRepository, FlightRepository, FlightReviewRepository)
    +calculate(String): Double
  }
  class StatisticsContext {
    StatisticsStrategy strategy
    +setStrategy(StatisticsStrategy): void
    +execute(String): Double
  }
  class FlightDetailService {
    FlightRepository flightRepository
    AirlineRepository airlineRepository
    +FlightDetailService(FlightRepository, AirlineRepository)
    +getFlightsByAirlineID(int): List<FlightsDataRequestDTO>
  }
  class TripTypeStatsService {
    TripTypeRepository tripTypeRepository
    AirlineRepository airlineRepository
    +TripTypeStatsService(TripTypeRepository, AirlineRepository)
    +getTripTypeStats(int): TripTypeStatsRequestDTO
    +getTripTypeStats(): TripTypeStatsRequestDTO
  }
  StatisticsStrategy <|.. FlightCountStatistics
  StatisticsStrategy <|.. RevenueStatistics
  StatisticsStrategy <|.. RatingStatistics
}

' =================== CONTROLLER PACKAGE ===================
package "controller" <<controller>> {
  class AuthController {
    AuthService authService
    +signup(UserDTO): ResponseEntity<?>
    +login(LoginDTO): ResponseEntity<?>
    +googleLogin(String): ResponseEntity<?>
  }
  class ForgotPasswordController {
    ForgetResetPasswordService forgetResetPasswordService
    +forgotPassword(String): ResponseEntity<?>
    +verifyOtp(String, String): ResponseEntity<?>
    +resetPassword(String, String, String): ResponseEntity<?>
  }
  class UserController {
    UserDataService userDataService
    +getUserData(String): ResponseEntity<UserDataResponse>
  }
  class AirlineDataController {
    AirlineDataService airlineDataService
    +getAirlineData(String): ResponseEntity<AirlineDataResponse>
    +updateAirlineData(String, AirlineUpdateDataRequest): ResponseEntity<?>
    +getAllAirports(String, String): ResponseEntity<List<Airport>>
    +getAllCountries(): ResponseEntity<List<CountryDtoResponse>>
    +getCitiesByCountry(String): ResponseEntity<List<CityDtoResponse>>
  }
  class HotelDataController {
    // Add methods based on file
  }
  class RoomTypeController {
    // Add methods
  }
  class FlightController {
    // Add methods
  }
  class PartnershipController {
    // Add methods
  }
  class AirlineStatisticsController {
    StatisticsContext statisticsContext
    +getFlightCount(String): ResponseEntity<Double>
    +getRevenue(String): ResponseEntity<Double>
    +getRating(String): ResponseEntity<Double>
  }
  class AirlineDetailedFlightsController {
    FlightDetailService flightDetailService
    +getFlightsByAirlineID(int): ResponseEntity<List<FlightsDataRequestDTO>>
  }
  class TripTypeStatisticsController {
    TripTypeStatsService tripTypeStatsService
    +getTripTypeStats(int): ResponseEntity<TripTypeStatsRequestDTO>
    +getTripTypeStats(): ResponseEntity<TripTypeStatsRequestDTO>
  }
  class FlightStatusController {
    // Add methods
  }
}

' =================== REPOSITORY PACKAGE ===================
package "repository" <<repository>> {
  interface UserRepository {
    +findByEmail(String): Optional<User>
    +save(User): User
  }
  interface AirlineRepository {
    +findById(Integer): Optional<Airline>
    +findByAdminUserID(Integer): Optional<Airline>
    +findAirlineIDByAirlineName(String): Integer
    +save(Airline): Airline
  }
  interface HotelRepository {
    +findByAdminUserID(Integer): Optional<Hotel>
    +save(Hotel): Hotel
  }
  interface FlightRepository {
    +findByAirline_AirlineID(Integer): List<Flight>
    +allFlightsIds(): List<Integer>
    +allFlightsIdsByAirlineId(Integer): List<Integer>
    +save(Flight): Flight
  }
  interface AirportRepository {
    +findByCountryAndCity(String, String): List<Airport>
    +findAllCountries(): List<CountryDtoResponse>
    +findAllCitiesByCountry(String): List<CityDtoResponse>
  }
  interface FlightTicketRepository {
    +findByIsPaidTrue(): List<FlightTicket>
    +findByAirlineAirlineIDAndIsPaidTrue(Integer): List<FlightTicket>
    +save(FlightTicket): FlightTicket
  }
  interface TripTypeRepository {
    +findAverageTicketsByTypeForAirlineID(Integer): List<Object[]>
    +findAverageTicketsByTypeForAllAirlines(): List<Object[]>
  }
  interface FlightReviewRepository {
    +findAllRatings(): List<Float>
    +findAllRatingsByFlightIds(List<Integer>): List<Float>
  }
  interface UserOtpRepository {
    +findByUserAndOtp(User, String): Optional<UserOtp>
    +save(UserOtp): UserOtp
    +delete(UserOtp): void
  }
}

' =================== DTO PACKAGE ===================
package "dto" <<dto>> {
  class UserDTO {
    String firstName
    String lastName
    String email
    String password
    String phoneNumber
  }
  class LoginDTO {
    String email
    String password
  }
  class UserDataResponse {
    String firstName
    String lastName
    String email
    String phoneNumber
    UserRole role
    UserStatus status
  }
  class AirlineDataResponse {
    String airlineName
    String airlineNationality
    Float airlineRate
    Integer numberOfRates
    String logoUrl
    Airline.Status status
  }
  class AirlineUpdateDataRequest {
    String name
    String nationality
    String logoUrl
  }
  class CountryDtoResponse {
    String country
  }
  class CityDtoResponse {
    String city
  }
  class FlightsDataRequestDTO {
    Integer flightId
    Integer airlineId
    String departureAirport
    String arrivalAirport
    LocalDateTime departureDate
    LocalDateTime arrivalDate
    String status
    String description
    String planeType
  }
  class TripTypeStatsRequestDTO {
    String name
    Map<TripTypeName, Double> avgMap
  }
  class HotelDataResponse {
    String hotelName
    String city
    String country
    Double longitude
    Double latitude
    Float hotelRate
    Integer numberOfRates
    String logoUrl
    Hotel.Status status
  }
  class HotelUpdateDataRequest {
    String name
    Double latitude
    Double longitude
    String city
    String country
    String logoUrl
  }
  class PartnershipResponse {
    // Add fields
  }
  class PartnershipRequest {
    // Add fields
  }
}

' =================== CONFIG PACKAGE ===================
package "config" <<config>> {
  class BackendApplication {
    +main(String[]): void
  }
  class DataInitializer {
    // Add methods
  }
}

@enduml
